<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Benchmark des pyramides cartographique</title>
<style>
  body { font-family: Arial, sans-serif; margin: 40px; background: #f9fafb; color: #222; }
  h1 { margin-bottom: 20px; }
  table { border-collapse: collapse; width: 100%; background: white; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; min-width: 120px; }
  th { background: #eef3ff; }
  td[contenteditable="true"], th[contenteditable="true"] { background: #fffdf5; }
  button { margin: 5px; padding: 6px 10px; }
  .toolbar { margin-bottom: 15px; }
  input[type=file] { display: none; }
</style>
</head>
<body>
<h1>Benchmark des pyramides cartographique</h1>

<div class="toolbar">
  <button onclick="ajouterLigne()">+ Ajouter une ligne</button>
  <button onclick="ajouterColonne()">+ Ajouter une colonne</button>
  <button onclick="supprimerLigne()">‚Äì Supprimer une ligne</button>
  <button onclick="supprimerColonne()">‚Äì Supprimer une colonne</button>
  <button onclick="exporterCSV()">üíæ Exporter CSV</button>
  <label for="importer" style="cursor:pointer; background:#ddd; padding:6px 10px; border-radius:4px;">üì• Importer CSV</label>
  <input type="file" id="importer" accept=".csv" onchange="importerCSV(event)">
  <button onclick="resetTable()">üßπ R√©initialiser</button>
</div>

<table id="tableau">
  <thead>
    <tr>
      <th>Fournisseur</th>
      <th>Type de pyramide</th>
      <th>Origine de la donn√©e</th>
      <th>Choix des donn√©es</th>
      <th>G√©n√©ralisation</th>
      <th>Niveaux</th>
      <th>Remarque</th>
    </tr>
  </thead>
  <tbody>
    <tr><th>OSM</th><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
    <tr><th>ESRI France</th><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
    <tr><th>Maptiler</th><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
    <tr><th>Nexis</th><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
    <tr><th>Via Michelin</th><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
    <tr><th>TOMTOM</th><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
    <tr><th>Dutch kadaster</th><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
    <tr><th>Google Maps</th><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
  </tbody>
</table>

<script>
const STORAGE_KEY = "benchmarkPyramides_v4";
const table = document.getElementById("tableau");

// Sauvegarder dans le navigateur
function saveTable() {
  localStorage.setItem(STORAGE_KEY, table.innerHTML);
}

// Charger depuis le navigateur
function loadTable() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) table.innerHTML = saved;
  attachListeners();
}

// Attacher les √©couteurs de sauvegarde
function attachListeners() {
  table.querySelectorAll("[contenteditable]").forEach(cell => {
    cell.addEventListener("input", saveTable);
  });
}

// Ajouter une ligne √† l‚Äôendroit choisi
function ajouterLigne() {
  const rowIndex = prompt("Ins√©rer la ligne avant quel num√©ro ? (1 = premi√®re, vide = fin)");
  const tbody = table.querySelector("tbody");
  const nbCols = table.rows[0].cells.length;
  const newRow = tbody.insertRow(rowIndex ? rowIndex - 1 : -1);
  for (let i = 0; i < nbCols; i++) {
    const cell = newRow.insertCell(i);
    if (i === 0) cell.outerHTML = "<th contenteditable='true'>Nouveau</th>";
    else cell.setAttribute("contenteditable", "true");
  }
  attachListeners();
  saveTable();
}

// Supprimer une ligne
function supprimerLigne() {
  const tbody = table.querySelector("tbody");
  const index = prompt("Num√©ro de ligne √† supprimer ? (1 = premi√®re)");
  if (index && tbody.rows[index - 1]) {
    tbody.deleteRow(index - 1);
    saveTable();
  }
}

// Ajouter une colonne
function ajouterColonne() {
  const colIndex = prompt("Ins√©rer la colonne avant quel num√©ro ? (1 = premi√®re, vide = fin)");
  const index = colIndex ? parseInt(colIndex) - 1 : -1;
  for (let r = 0; r < table.rows.length; r++) {
    const row = table.rows[r];
    const cell = row.insertCell(index);
    if (r === 0) cell.outerHTML = "<th contenteditable='true'>Nouvelle colonne</th>";
    else cell.setAttribute("contenteditable", "true");
  }
  attachListeners();
  saveTable();
}

// Supprimer une colonne
function supprimerColonne() {
  const colIndex = prompt("Num√©ro de colonne √† supprimer ? (1 = premi√®re)");
  if (!colIndex) return;
  const index = parseInt(colIndex) - 1;
  for (let r = 0; r < table.rows.length; r++) {
    if (table.rows[r].cells[index]) table.rows[r].deleteCell(index);
  }
  saveTable();
}

// Exporter le tableau en CSV
function exporterCSV() {
  let csv = [];
  for (let row of table.rows) {
    let rowData = [];
    for (let cell of row.cells) {
      let text = cell.innerText.replace(/"/g, '""');
      rowData.push('"' + text + '"');
    }
    csv.push(rowData.join(","));
  }
  const blob = new Blob([csv.join("\n")], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "benchmark_pyramides.csv";
  a.click();
}

// Importer un fichier CSV
function importerCSV(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const lines = e.target.result.split(/\r?\n/).filter(l => l.trim());
    table.innerHTML = "";
    lines.forEach((line, i) => {
      const row = table.insertRow(-1);
      const cells = line.match(/("([^"]|"")*"|[^,]+)/g) || [];
      cells.forEach((text, j) => {
        const clean = text.replace(/^"|"$/g, "").replace(/""/g, '"');
        const cell = row.insertCell(-1);
        cell.textContent = clean;
        if (i === 0) cell.outerHTML = `<th contenteditable="true">${clean}</th>`;
        else cell.setAttribute("contenteditable", "true");
      });
    });
    saveTable();
    attachListeners();
  };
  reader.readAsText(file);
}

// R√©initialiser la table
function resetTable() {
  if (confirm("Supprimer toutes les donn√©es et restaurer la table d'origine ?")) {
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }
}

loadTable();
</script>
</body>
</html>
